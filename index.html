<!DOCTYPE html>
<html>
    <head>
        <title>Dark Library</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="https://www.seekpng.com/png/detail/127-1271485_animeicon-tokyoghoul-kanekiken-anime-icon-kaneki-tokyo-ghoul.png">
        <style>
            
            body{
                background-color: #1E2529;
            }
            .header{
                position: absolute;
                top: 0%;
                left: 0%;
                width: 100%;
                height: 12%;
                background-color: #171D20;
            }
            .title{
                position: relative;
                color: #1b79d7;
                text-align: center;
            }
            .amod{
                color:#595f63;
            }
            .description{
                position: absolute;
                text-align: center;
                top: 10%;
            }
            
            .flex-container{

                position: absolute;
                left: 0%;
                top:40%;
                width: 100%;
                height: 100%;
            }
            
            .unit{
                margin-top: 10px;
                position:relative;
                top: 0%;
                left: 15%;
                width:70%;
                height:20%;
                background-color: whitesmoke;
                border-radius: 10px;
            }
            .name{
                position:relative;
                top: -111%;
                left: 22.5%;
            }
            .unitdesc{
                position:relative;
                top: -111%;
                left: 22.5%;
                white-space:normal;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 250px;
            }
            .add{
                position: absolute;
                top:10%;
                left:75%;
                width: 20%;
                height: 80%;
            }
            .searchItems{
                position: absolute;
                left: 40%;
                top: 32.5%;
                visibility: hidden;
            }
            
            @media only screen and (max-device-width: 480px){
                .unit{
                    top:20%;
                    width:70%;
                    height: 15%;
                    font-size: 10px;
                }
                .unitdesc{
                    white-space:normal;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    max-width: 150px;
                }
                .searchItems{
                    top:50%;
                    left:25%;
                }
            }
            
            
        </style>
    </head>
    <body>
        <span class="header"></span>
        <h1 class="title"><b>Dark's Library</b></h1>
        <p class="description">Welcome to Dark's Library for Ketsu Modules. On this website you can find the latest and greatest modules availiable for the app! Modules are pieces of information fed to the app so that it displays a website in an app format. There are modules of all kinds such as Anime and even Cuisine recipes! You can find all these modules here!
            <br>
            <b>
            <a href="https://appketsu.github.io/KETSU-Documentation/index.html" class="amod">If you would like to make a module for the app yourself click here for the KETSU-Documentation!</a></b> 
            <br>
            <a href="Modules/Module Template.zip" class='amod' download>To download the template press here!</a>
        </p>
        <div class='searchItems'>
            <input class='searchbar' placeholder="Search Something!"><button class='submit' onclick='Search()'>Search</button><button class='submit' onclick='clearSearch()'>Clear Results!</button>
        </div>
        
        
        <div class="flex-container">
            
        </div>
        
        
        
        
        
        
        
        
        
        <script>
            var units = [];
        function Search(){
            var search = document.querySelector('.searchbar').value;
            (document.querySelectorAll('.flex-container > div')).forEach((element,index)=>{
                if(!element.querySelector('.name').innerText.toLowerCase().includes(search.toLowerCase())){
                    element.style.display = 'none';
                }else{
                    element.style.display = 'block';
                }
            });
        }
        function clearSearch(){
            (document.querySelectorAll('.flex-container > div')).forEach((element,index)=>{
                element.style.display = 'block';
            });
        }
        function Unit(name,order,description,image,link){
            this.name = name;
            this.order = order;
            this.description = description;
            this.image = image;
            this.link = 'ketsuapp://?moduleData='+link;
        }
        async function readTextFile(type){
            let array;
            if(type == 1){
                await fetch('https://raw.githubusercontent.com/DarkZCore/DarkLibrary/master/ModuleList.txt').then(res => res.text()).then(text => array = text);
            }else if(type = 2){
                await fetch('https://raw.githubusercontent.com/DarkZCore/DarkLibrary/master/ResolverList.txt').then(res => res.text()).then(text => array = text);
            }
            return array;
        }
        function createObject(unit){
            var element = document.querySelector('.flex-container');
            element.innerHTML += `<div class='unit'><img src=${unit.image} width="20%" height="100%" style="border-top-left-radius: 10px;border-bottom-left-radius: 10px;"><h2 class='name'>${unit.name}</h2><p class='unitdesc' width='20px'>${unit.description}</p><a href=${unit.link}><button class='add'>Add</button></a></div>`;
        }
            async function startUp(){
                let modules = (await readTextFile(1)).split('\n');
                var count = 0;
                await (modules).forEach(async (element,index) =>{
                    await fetch(`https://raw.githubusercontent.com/DarkZCore/DarkLibrary/master/Modules/${element}/moduleTemplate.json`).then(res => res.json()).then(theText => {
                        units.push(new Unit(theText.moduleInfo.moduleName,index,theText.moduleInfo.moduleDesc,theText.moduleInfo.moduleImage,`https://raw.githubusercontent.com/DarkZCore/DarkLibrary/master/Modules/${element.replace(' ','%20')}/moduleTemplate.json`));
                        count++;
                        if(count == modules.length){
                        (units).forEach((element2) =>{
                            createObject(element2); 
                        });
                        document.querySelector('.searchItems').style.visibility = 'visible';
                    }
                    });
                });
                
                
            }
            startUp();
        
        </script>
    </body>
</html>